<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>New render API for gym library | Omar G. Younis</title> <meta name="author" content="Omar G. Younis"/> <meta name="description" content="The new Render API for gym is out!"/> <meta name="keywords" content="machine-learning, phd, software, engineer"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§ </text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://younis.dev/blog/render-api/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://younis.dev/"><span class="font-weight-bold">Omar</span> G. Younis</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/activities/">activities</a> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">New render API for gym library</h1> <p class="post-meta">June 9, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a> Â  Â· Â  <a href="/blog/tag/gym"> <i class="fas fa-hashtag fa-sm"></i> gym</a> Â  Â  Â· Â  <a href="/blog/category/programming"> <i class="fas fa-tag fa-sm"></i> programming</a> Â  <a href="/blog/category/AI"> <i class="fas fa-tag fa-sm"></i> AI</a> Â  </p> </header> <article class="post-content"> <p>I am writing this blog post to explain what has changed, the reasons behind this and how to adapt your current environment to the new API.</p> <h2 id="what-is-new">What is new?</h2> <p>If you have ever used Gym, you are probably familiar with this code:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> <td class="code"><pre><span class="kn">import</span> <span class="nn">gym</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="p">.</span><span class="n">make</span><span class="p">(</span><span class="s">"FrozenLake-v1"</span><span class="p">)</span>
<span class="n">env</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">action_space</span><span class="p">.</span><span class="n">sample</span><span class="p">())</span>
    <span class="n">env</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>

<span class="n">env</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>where we just create an instance of the <em>FrozenLake</em> environment and we act randomly for 100 steps. In line 8, we render a single frame representing the current state of the environment. The method <code class="language-plaintext highlighter-rouge">render</code> accepts a keyword argument <em>mode</em>; in the above case, we use the default value, i.e. <em>human</em>.</p> <p>With the new API, you need to specify the render mode at initialization, and the environment will take care to render each frame. Thus, in the case of <em>human</em> rendering, you donâ€™t need to call the <code class="language-plaintext highlighter-rouge">render</code> at all!</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> <td class="code"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="p">.</span><span class="n">make</span><span class="p">(</span><span class="s">"FrozenLake-v1"</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="s">"human"</span><span class="p">)</span>

<span class="n">env</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">action_space</span><span class="p">.</span><span class="n">sample</span><span class="p">())</span>

<span class="n">env</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>For render modes that are expected to return something, you can still get the result with <code class="language-plaintext highlighter-rouge">.render()</code>:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> <td class="code"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="p">.</span><span class="n">make</span><span class="p">(</span><span class="s">"FrozenLake-v1"</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="s">"rgb_array"</span><span class="p">)</span>

<span class="n">env</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">action_space</span><span class="p">.</span><span class="n">sample</span><span class="p">())</span>
    <span class="n">env</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>  <span class="c1"># return a ndarray frame
</span>
<span class="n">env</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>With this new API, we also introduce <code class="language-plaintext highlighter-rouge">_list</code> modes. In this case, the environment will save all the frames internally, and you can retrieve all of them at once calling <code class="language-plaintext highlighter-rouge">render</code>:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> <td class="code"><pre><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="p">.</span><span class="n">make</span><span class="p">(</span><span class="s">"FrozenLake-v1"</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="s">"rgb_array_list"</span><span class="p">)</span>

<span class="n">env</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">env</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="p">.</span><span class="n">action_space</span><span class="p">.</span><span class="n">sample</span><span class="p">())</span>

<span class="n">frame_collection</span> <span class="o">=</span> <span class="n">env</span><span class="p">.</span><span class="n">render</span><span class="p">()</span>
<span class="n">env</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>The frame collection will be a list of 101 <em>rgb arrays</em> (1 after the initial reset and 100 steps).</p> <p>If you donâ€™t want rendering, you can just ignore the <code class="language-plaintext highlighter-rouge">render_mode</code> attribute.</p> <h2 id="how-to-update-your-environment">How to update your environment?</h2> <p>Updating your environment to this new API is super easy. <br> You just need to follow these 3 steps:</p> <p><strong>1. Add render_mode argument to init</strong>:</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">
</span><span class="gd">- def __init__(self, ...)
</span><span class="gi">+ def __init__(self, render_mode: Optional[str] = None, ...)
</span>    ...
<span class="gi">+   self.render_mode = render_mode
</span></code></pre></div></div> <p>We assume that every environment can not render; thus, you donâ€™t need to add <em>None</em> to <code class="language-plaintext highlighter-rouge">self.metadata["render_modes"]</code>. Remember to specify the attribute <code class="language-plaintext highlighter-rouge">render_mode</code> for your environment. Then:</p> <p><strong>2. Remove mode argument to render function and change all occurrences</strong></p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- def render(self, mode="human"):
</span><span class="gi">+ def render(self):
+   mode = self.render_mode
</span><span class="err">
</span></code></pre></div></div> <p>For human mode, we want rendering to be automatic, thus:</p> <p><strong>3. Update the step and reset methods</strong></p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">def step(self, action):
</span>    ...
<span class="gi">+   if self.render_mode == "human":
+       self.render()
</span><span class="err">
</span>...
<span class="err">
</span><span class="p">def reset(self, ...):
</span>    ...
<span class="gi">+   if self.render_mode == "human":
+       self.render()
</span></code></pre></div></div> <p>At this point, your environment is supporting the new render API. Your environment will automatically support also collection of frames because this is handled by <a href="https://github.com/openai/gym/blob/master/gym/wrappers/render_collection.py" target="_blank" rel="noopener noreferrer">RenderCollection</a> wrapper. If you want a custom code for handling frame collection modes, you just need to add the new mode to <code class="language-plaintext highlighter-rouge">env.metadata['render_modes']</code>, and the environment will not be wrapped by <code class="language-plaintext highlighter-rouge">RenderCollection</code>.</p> <h2 id="why-this-api">Why this API?</h2> <p>As you may noticed, this API forbids the change of the render mode on-the-fly, but let the environment knows the render mode at initialization. This is important for some environment, since they need different initialization process for different mode, thus overcomplicated code to adhere to the old API. Moreover, some environments donâ€™t naturally render at each step (or they have multiple frames if they arenâ€™t static) but easily generate the rendering at the end of the episode. Finally, old API didnâ€™t allow to extract a smooth video when using <em>frame skipping</em>.</p> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> Â© Copyright 2022 Omar G. Younis. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. VAT 04387850987 </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>